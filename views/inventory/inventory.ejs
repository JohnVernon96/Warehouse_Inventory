<% include ../partials/header %>

<link rel="stylesheet" href="./inventory.css">

<div class="container">
    <h1>Warehouse Inventory</h1>
    <div class="row jumbotron text-white">
        <div class="inv-container col-sm col-md col-lg col-xl">
            <p>
                <table class="table table-condensed table-responsive">
                    <!-- <caption>Condensed Table Layout</caption> -->
                    <thead>
                        <tr>
                            <th>Item ID</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Date Recieved</th>
                            <th>Storage Location</th>
                            <th>Present</th>
                            <th>Reserved</th>
                            <th>Edit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for(var i = 0; i < items.rowCount; i++) { %>
                        <tr>
                            <td><%= items.rows[i].inv_id %></td>
                            <td><%= items.rows[i].description %></td>
                            <td><%= items.rows[i].category %></td>
                            <td><%= items.rows[i].date_recieved %></td>
                            <td><%= items.rows[i].storage_location %></td>

                            <!-- PRESENT -->
                            <td>
                                <% if(items.rows[i].present === 'no') { %>
                                <input type="checkbox">
                                <% } else { %>
                                <input type="checkbox" checked>
                                <% } %>
                            </td>

                            <!-- RESERVED -->
                            <td>
                                <% if(items.rows[i].reserved === 'no') { %>
                                <input type="checkbox">
                                <% } else { %>
                                <input type="checkbox" checked>
                                <% } %>
                            </td>
                            <td>
                                <button class="showbtn" data-toggle="modal" data-target="#viewItem" data-id=<%=items.rows[i].inv_id%>>Edit</button>
                            </td>
                        </tr>
                        <% } %>
                    </tbody>
                </table>
            </p>
            <div class="btn-container">
                <a class="btn btn-primary btn-lg" href="/inventory/new" role="button" id="newItemButton">New Item</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="viewItem" tabindex="-1" role="dialog" aria-labelledby="viewItemLabel">
    <div class="modal-dialog modal-lg container row" role="document">
        <div class="modal-content inv-container col-sm col-md col-lg col-xl">
            <div class="modal-header">
                <button type="btn btn-sm" class="close" data-dismiss="modal">&times;</button>
                <h3>Item Details</h3>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
                <button type="button" onclick="myFun()" class="btn btn-primary">Yes</button>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">

var getData = async function(id){
    const url = `/inv-items/${id}`;
    const resp = await fetch(url)
    const data = await resp.json()
    if (data.items.rowCount < 1){
        document.querySelector('#hiddenvalue').value = "No Item History."
    }else {
        const rows = data.items.rows
        let tbl = document.querySelector('.inv-his-table')
        if(tbl) tbl.remove();

        tbl = document.createElement('TABLE');
        tbl.classList.add('inv-his-table')
        tbl.classList.add('table')
        tbl.classList.add('table-condensed')
        tbl.classList.add('table-responsive')
        tbl.border = '5px';
        var thead = document.createElement('THEAD')
        tbl.appendChild(thead)
        var tabTr = document.createElement('TR')
        thead.appendChild(tabTr)
        for (var key in rows[0]){
            var tabTh = document.createElement('TH')
            tabTh.textContent = key;
            tabTr.appendChild(tabTh)
        }
        var tabBod = document.createElement('tbody')
        tbl.appendChild(tabBod)

        rows.forEach(row => {
            var tabTr = document.createElement('TR');
            tabBod.appendChild(tabTr);
            for(var key in row){
                var tabTh = document.createElement('TH')
                tabTh.textContent = row[key]
                tabTr.appendChild(tabTh)
                // document.querySelector('#hiddenvalue').value += key;
                // document.querySelector('#hiddenvalue').value += ": " + row[key];
            }
        })
        var modalBod = document.querySelector('.modal-body')
        modalBod.appendChild(tbl)
    }
}

$(document).ready(function() {

    $('a[data-toggle=modal], button[data-toggle=modal]').click(function () {

        var data_id = '';
        var data_desc = '';

        if (typeof $(this).data('id') !== 'undefined') {
            data_id = $(this).data('id');
        }

        if (typeof $(this).data('description') !== 'undefined') {
            data_desc = $(this).data('description');
        }
        getData(data_id);
    })
});

</script>

<% include ../partials/footer %>
